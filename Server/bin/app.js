"use strict";
exports.__esModule = true;
var express = require("express");
var path = require("path");
var logger = require("morgan");
var cookieParser = require("cookie-parser");
var bodyParser = require("body-parser");
var mongoose = require("mongoose");
var cors = require("cors");
var multer = require("multer");
var homeController = require("./controllers/home");
var test = require("./controllers/test");
var Services = require("./controllers");
var Articles = require("./controllers/article");
var Upload = require("./controllers/upload");
var app = express();
var upload = multer({ dest: "uploads/" });
//  const NODE_ENV = process.env.NODE_ENV;
//  const isDevelopment: boolean = NODE_ENV === "development";
mongoose.connect("mongodb://localhost:27017");
mongoose.connection.on("error", function () {
    console.log("MongoDB connection error. Please make sure MongoDB is running...");
    process.exit();
});
// if (isDevelopment) {
//   app.use(cors({ "origin": "http://localhost:3333" }));
//   console.log("只有在开发模式中才允许跨域访问, 且主机必须为 http://localhost:3333 !");
// }
app.use(cors());
app.use(logger("dev"));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({ extended: false }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, "dist")));
app.use(express.static(path.join(__dirname, "uploads")));
app.get("/", homeController.index);
app.post("/api/test", test.test);
app.post("/api/register", Services.register);
app.post("/api/login", Services.login);
app.post("/api/getUserInfo", Services.getUserInfo);
app.post("/api/setUserInfo", Services.setUserInfo);
app.post("/api/publishArticle", Articles.publishArticle);
app.post("/api/getArticles", Articles.getArticles);
app.post("/api/getArticle", Articles.getArticle);
app.post("/api/setArticle", Articles.setArticle);
app.post("/api/delArticle", Articles.delArticle);
app.post("/api/uploadImg", upload.single("avatar"), Upload.uploadImg);
module.exports = app;
